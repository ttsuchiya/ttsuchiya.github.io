(this["webpackJsonpmedrhythms-djmix"]=this["webpackJsonpmedrhythms-djmix"]||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(6),i=n.n(c),l=(n(15),n(16),n(4)),o=n.n(l),s=n(7),u=n(5),d=n(3),f=n(2),b=Object(f.c)({name:"fileHandler",initialState:{files:[],metaData:{},readyToAnalyze:!1,metaDataReady:!1},reducers:{addFile:function(e,t){var n=t.payload;e.files.push(n)},addMetaData:function(e,t){var n=t.payload,a=n.file,r=n.data;e.metaData[a]=r},clearFiles:function(e){e.files=[],e.metaData={},e.readyToAnalyze=!1},setReadyToAnalyze:function(e,t){var n=t.payload;e.readyToAnalyze=n}}}),p=b.actions,h=p.addFile,m=p.addMetaData,j=p.setReadyToAnalyze,v=b.actions.clearFiles,y=function(e){return e.fileHandler.files},g=function(e){return e.fileHandler.metaData},x=function(e){return e.fileHandler.readyToAnalyze},O={};function w(e,t){O[e]=t}function C(e){return O[e]}var k=Object(f.b)("fileHandler",(function(e,t){(0,t.dispatch)(v()),Object.keys(O).forEach((function(e){delete O[e]}))})),A=b.reducer,F=Object(f.c)({name:"renderer",initialState:{contextReady:!1,readyToRender:!1,playing:!1,fullMix:!1},reducers:{setContextReady:function(e,t){var n=t.payload;e.contextReady=n},setReadyToRender:function(e,t){var n=t.payload;e.readyToRender=n},setPlaying:function(e,t){var n=t.payload;e.playing=n},setFullMix:function(e,t){var n=t.payload;e.fullMix=n}}}),T=F.actions,N=T.setContextReady,M=T.setReadyToRender,R=T.setPlaying,D=T.setFullMix,S=function(e){return e.renderer.readyToRender},P=function(e){return e.renderer.playing},E=function(e){return e.renderer.fullMix},U=F.reducer,z=Object(f.c)({name:"parameters",initialState:{loudness:-12,filterFreq:0,tempo:120,averageTempo:120,useAverageTempo:!0},reducers:{setLoudness:function(e,t){var n=t.payload;e.loudness=n},setFilterFreq:function(e,t){var n=t.payload;e.filterFreq=n},setTempo:function(e,t){var n=t.payload;e.tempo=n},setAverageTempo:function(e,t){var n=t.payload;e.averageTempo=n},setUseAverageTempo:function(e,t){var n=t.payload;e.useAverageTempo=n}}}),q=z.actions,B=q.setLoudness,H=q.setFilterFreq,L=q.setTempo,_=q.setAverageTempo,I=q.setUseAverageTempo,J=function(e){return e.parameters.loudness},V=function(e){return e.parameters.filterFreq},W=function(e){return e.parameters.tempo},G=function(e){return e.parameters.useAverageTempo},K=z.reducer,Y=new(window.AudioContext||window.webkitAudioContext),$=window.Kali,Q=[],X=Object(f.b)("renderer/resumeAudioContext",function(){var e=Object(u.a)(o.a.mark((function e(t,n){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.dispatch,r=n.getState,!r().renderer.contextReady){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return a(N(t)),e.abrupt("return",Y.resume());case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());function Z(e){return e.arrayBuffer().then((function(e){return Y.decodeAudioData(e)}))}function ee(e,t){for(var n=e.numberOfChannels,a=4096*n,r=e.length,c=Math.floor(r/t+1),i=Y.createBuffer(n,c,Y.sampleRate),l=0;l<n;l++){var o=new $(1);o.setup(Y.sampleRate,t,!1);for(var s=0,u=0,d=!1,f=e.getChannelData(l),b=new Float32Array(c);u<b.length;)if(u+=o.output(b.subarray(u,Math.min(u+a,b.length))),s<r){var p=f.subarray(s,Math.min(s+a,r));s+=p.length,o.input(p),o.process()}else d||(o.flush(),d=!0);i.getChannelData(l).set(b)}return i}function te(e,t){var n,a=function(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var a=Math.floor(Math.random()*n),r=t[n];t[n]=t[a],t[a]=r}return t}(y(e)),r=J(e),c=W(e),i=-96===(n=r)?0:Math.pow(10,n/20),l=0;return a.flatMap((function(n,r){var o=g(e)[n],u=i/o.rms,d=c/o.tempo,f=C(n),b=[],p=0===r,h=r===a.length-1;if(t){var m=ee(f,d),j=m.duration;b.push({name:n,buffer:m,gain:u,offset:l,first:p,last:h}),l+=j-10}else{var v=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=e.sampleRate,r=e.numberOfChannels,c=Math.ceil(e.sampleRate*n*t),i=Y.createBuffer(r,c,a),l=Y.createBuffer(r,c,a),o=e.length,s=0;s<r;s++)for(var u=e.getChannelData(s),d=i.getChannelData(s),f=l.getChannelData(s),b=0;b<c;b++)d[b]=u[b],f[b]=u[o-c+b];var p=ee(i,t),h=ee(l,t);return[p,h]}(f,d),y=Object(s.a)(v,2),x=y[0],O=y[1];b.push({name:"".concat(n," (head)"),buffer:x,gain:u,offset:l,first:p,last:!1},{name:"".concat(n," (tail)"),buffer:O,gain:u,offset:l+5,first:!1,last:h}),l+=10}return b}))}function ne(e,t,n,a,r,c,i,l){var o=e.createBufferSource(),s=e.createBiquadFilter(),u=e.createGain();o.buffer=t,s.type="highpass",s.frequency.value=c,r*=.75;var d=t.duration;return u.gain.setValueAtTime(i?0:r,n+a),i&&u.gain.setTargetAtTime(r,n+a,i),l&&u.gain.setTargetAtTime(0+Number.EPSILON,n+a+d-l,l),o.connect(s),s.connect(u),u.connect(e.destination),o.start(n+a),o}var ae=Object(f.b)("renderer/playTrackSequence",(function(e,t){var n=t.dispatch,a=(0,t.getState)(),r=V(a),c=E(a),i=te(a,c);(Q=i.map((function(e){var t=c?10:5,n=Y.currentTime;return ne(Y,e.buffer,n,e.offset,e.gain,r,!e.first*t,!e.last*t)})))[Q.length-1].onended=function(){n(R(!1))},n(R(!0))})),re=Object(f.b)("renderer/stopPlayback",(function(e,t){var n=t.dispatch;Q.forEach((function(e){return e.stop()})),Q=[],n(R(!1))})),ce=Object(f.b)("renderer/renderTrackSequence",(function(e,t){var n=(0,t.getState)(),a=V(n),r=E(n),c=te(n,r),i=c.reduce((function(e,t){var n=t.buffer,a=t.last;return e+n.length-(a?0:44100*(r?10:5))}),0),l=new OfflineAudioContext(2,i,44100);c.forEach((function(e){var t=r?10:5,n=l.currentTime;ne(l,e.buffer,n,e.offset,e.gain,a,!e.first*t,!e.last*t)})),l.startRendering().then((function(e){!function(e){var t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display:none",n.href=t,n.download="djmix.wav",n.click(),URL.revokeObjectURL(t),document.body.removeChild(n)}(function(e){var t,n;2===e.numberOfChannels?(t=e.getChannelData(0),n=e.getChannelData(1)):(t=e.getChannelData(0),n=e.getChannelData(0));var a=function(e,t){var n=new ArrayBuffer(44+2*e.length),a=new DataView(n);return ie(a,0,"RIFF"),a.setUint32(4,32+2*e.length,!0),ie(a,8,"WAVE"),ie(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,2,!0),a.setUint32(24,t,!0),a.setUint32(28,4*t,!0),a.setUint16(32,4,!0),a.setUint16(34,16,!0),ie(a,36,"data"),a.setUint32(40,2*e.length,!0),function(e,t,n){for(var a=0;a<n.length;a++,t+=2){var r=Math.max(-1,Math.min(1,n[a]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(a,44,e),a}(function(e,t){var n=e.length+t.length,a=new Float32Array(n),r=0,c=0;for(;r<n;)a[r++]=e[c],a[r++]=t[c],c++;return a}(t,n),e.sampleRate);return new Blob([a],{type:"audio/wav"})}(e))}))}));function ie(e,t,n){for(var a=0;a<n.length;a++)e.setUint8(t+a,n.charCodeAt(a))}var le=Object(f.b)("fileHandler/processFiles",function(){var e=Object(u.a)(o.a.mark((function e(t,n){var a,r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.dispatch,t||0!==t.length){e.next=5;break}return e.abrupt("return",Promise.reject());case 5:if(1!==t.length){e.next=10;break}return r=t[0],e.abrupt("return",Z(r).then((function(e){a(h(r.name)),w(r.name,e)})));case 10:return c=Array.from(t),e.abrupt("return",Promise.all(c.map((function(e){return Z(e).then((function(t){a(h(e.name)),w(e.name,t)}))}))));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),oe=n(0);function se(){var e=Object(d.b)(),t=Object(a.useRef)();function n(){return(n=Object(u.a)(o.a.mark((function t(n){var a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e(k()),e(M(!1)),t.next=4,e(X(!0));case 4:return t.next=6,e(le(null===(a=n.target)||void 0===a?void 0:a.files));case 6:e(j(!0));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function r(){return(r=Object(u.a)(o.a.mark((function t(n){var a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),e(k()),e(M(!1)),t.next=5,e(X(!0));case 5:if((a=n.dataTransfer.files).length){t.next=10;break}alert("Oops! Could not capture the files (it may be a browser bug). Please try again and it might work..."),t.next=13;break;case 10:return t.next=12,e(le(a));case 12:e(j(!0));case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var c=Object(a.useState)(!1),i=Object(s.a)(c,2),l=i[0],f=i[1];return Object(oe.jsxs)("div",{className:"\n        w-full py-8\n        border-4 border-solid\n        ".concat(l?"border-gray-400":"border-gray-200","\n        flex flex-col justify-center items-center\n      "),onDrop:function(e){return r.apply(this,arguments)},onDragOver:function(e){return e.preventDefault()},onClick:function(e){t.current.click(),e.stopPropagation()},onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},children:[Object(oe.jsx)("input",{type:"file",id:"file-loader",name:"file-loader",multiple:!0,accept:"audio/*",onInput:function(e){return n.apply(this,arguments)},className:"hidden",ref:t,onClick:function(e){return e.stopPropagation()}}),Object(oe.jsx)("label",{htmlFor:"file-loader",onClick:function(e){return e.stopPropagation()},children:"Drag and drop or click here to upload audio files."})]})}var ue=Object(f.c)({name:"analyzer",initialState:{partialScan:!0},reducers:{setPartialScan:function(e,t){var n=t.payload;e.partialScan=n}}}),de=ue.actions.setPartialScan,fe=function(e){return e.analyzer.partialScan},be=ue.reducer;window.result={peak:null,rms:null,tempo:null};var pe=Object(f.b)("analyzer/calcAverageTempo",(function(e,t){var n=t.dispatch,a=t.getState,r=y(a());if(r.length){var c=g(a()),i=Math.round(r.reduce((function(e,t){return e+c[t].tempo}),0)/r.length);n(L(i)),n(_(i))}else n(L(120)),n(_(120))})),he=Object(f.b)("analyzer/callAnalyzer",(function(e,t){var n=t.dispatch,a=t.getState,r=y(a()),c=fe(a());n(j(!1)),n(M(!1)),r.forEach((function(e,t){var a=window.Module,r=a._malloc(4*Float32Array.BYTES_PER_ELEMENT);new Float32Array(a.HEAP32.buffer,r,4).fill(0);var i=C(e);if(1===i.numberOfChannels){var l=i.getChannelData(0);c&&(l=l.slice(220500,1984500));var o=a._malloc(l.byteLength);new Float32Array(a.HEAP32.buffer,o,l.length).set(l),a.ccall("analyzeMono",null,["number","number","number","number"],[o,l.length,r,4]),a._free(o)}else{var s=i.getChannelData(0),u=i.getChannelData(1);c&&(s=s.slice(661500,1984500),u=u.slice(661500,1984500));var d=a._malloc(s.byteLength);new Float32Array(a.HEAP32.buffer,d,s.length).set(s);var f=a._malloc(u.byteLength);new Float32Array(a.HEAP32.buffer,f,u.length).set(u),a.ccall("analyzeStereo",null,["number","number","number","number","number"],[d,f,s.length,r,4]),a._free(d),a._free(f)}n(m({file:e,data:Object.assign({},window.result)})),a._free(r)})),n(pe()),n(j(!0)),n(M(!0))}));function me(){var e=Object(d.b)(),t=Object(d.c)(x),n=Object(d.c)(fe);return Object(oe.jsxs)("div",{className:"\n      flex items-center justify-evenly\n      border-4 border-solid \n      ".concat(t?"border-gray-400":"border-gray-200","\n      w-full py-2\n    "),children:[Object(oe.jsx)("button",{disabled:!t,onClick:function(){return e(he())},children:"Analyze"}),Object(oe.jsxs)("div",{children:[Object(oe.jsx)("input",{type:"checkbox",id:"partial-scan",defaultChecked:n,onChange:function(t){e(de(t.target.checked))}}),Object(oe.jsx)("label",{htmlFor:"partial-scan",children:"Partial Scan"})]})]})}function je(){var e=Object(d.b)(),t=Object(d.c)(J),n=Object(d.c)(V),r=Object(d.c)(W),c=Object(d.c)(G),i=Object(d.c)(S);function l(t){var n=parseInt(t.target.value);isNaN(n)||n>0||n<-96||e(B(n))}function o(t){var n=parseInt(t.target.value);isNaN(n)||n>3e3||n<0||e(H(n))}function s(t){var n=parseInt(t.target.value);isNaN(n)||(n<40&&(n=40),n>180&&(n=180),e(L(n)))}Object(a.useEffect)((function(){}),[t,n,r]);var u="\n    w-full py-1 space-x-4 px-4\n    flex justify-between items-center  \n  ",f="w-1/5 pl-4",b="w-1/3",p="w-1/3 space-x-2";return Object(oe.jsxs)("div",{className:"\n      border-4 border-solid\n      ".concat(i?"border-gray-400":"border-gray-200","\n      w-full py-2 space-y-2\n      flex flex-col items-center justify-center\n    "),children:[Object(oe.jsxs)("div",{className:u,children:[Object(oe.jsx)("label",{className:f,htmlFor:"dbfs",children:"Loudness:"}),Object(oe.jsx)("input",{className:b,type:"range",min:-96,max:0,value:t,onChange:l}),Object(oe.jsxs)("div",{className:p,children:[Object(oe.jsx)("input",{type:"number",id:"dbfs",name:"dbfs",value:t,onChange:l}),Object(oe.jsx)("span",{children:"dBFS"})]})]}),Object(oe.jsxs)("div",{className:u,children:[Object(oe.jsx)("label",{className:f,htmlFor:"freq",children:"HPF Freq:"}),Object(oe.jsx)("input",{className:b,type:"range",min:0,max:3e3,value:n,onChange:o}),Object(oe.jsxs)("div",{className:p,children:[Object(oe.jsx)("input",{type:"number",id:"freq",name:"freq",value:n,onChange:o}),Object(oe.jsx)("span",{children:"Hz"})]})]}),Object(oe.jsxs)("div",{className:u,children:[Object(oe.jsx)("label",{className:f,htmlFor:"bpm",children:"Tempo:"}),Object(oe.jsx)("input",{className:b,type:"range",min:40,max:180,value:r,disabled:c,onChange:s}),Object(oe.jsxs)("div",{className:p,children:[Object(oe.jsx)("input",{type:"number",id:"bpm",name:"bpm",value:r,onChange:s,disabled:c}),Object(oe.jsx)("span",{children:"BPM"})]})]}),Object(oe.jsxs)("div",{className:"pb-1",children:[Object(oe.jsx)("input",{type:"checkbox",id:"use-avg-tempo",name:"use-avg-tempo",defaultChecked:c,onChange:function(t){e(I(t.target.checked)),t.target.checked&&e(pe())}}),Object(oe.jsx)("label",{htmlFor:"use-avg-tempo",children:"Use the average tempo of the tracks"})]})]})}function ve(){var e=Object(d.b)(),t=Object(d.c)(E);function n(t){e(D("full"===t.target.value))}return Object(oe.jsxs)("div",{className:"\n      w-2/5\n    ",children:[Object(oe.jsxs)("div",{children:[Object(oe.jsx)("input",{type:"radio",id:"full",name:"mix",value:"full",defaultChecked:t,onChange:n}),Object(oe.jsx)("label",{htmlFor:"full",children:"Full Mix"})]}),Object(oe.jsxs)("div",{children:[Object(oe.jsx)("input",{type:"radio",id:"preview",name:"mix",value:"preview",defaultChecked:!t,onChange:n}),Object(oe.jsx)("label",{htmlFor:"preview",children:"Preview Mix"})]})]})}function ye(){var e=Object(d.b)(),t=Object(d.c)(S),n=Object(d.c)(P);return Object(oe.jsxs)("div",{className:"\n      w-full py-2\n      border-4 border-solid\n      ".concat(t?"border-gray-400":"border-gray-200"," \n      flex items-center justify-around\n    "),children:[Object(oe.jsxs)("div",{className:"\n        w-3/5\n        flex justify-center\n        space-x-2\n      ",children:[Object(oe.jsx)("button",{disabled:!t||n,onClick:function(){e(ae())},children:"Play"}),Object(oe.jsx)("button",{disabled:!(t&&n),onClick:function(){e(re())},children:"Stop"}),Object(oe.jsx)("button",{disabled:!t,onClick:function(){e(ce())},children:"Download"})]}),Object(oe.jsx)(ve,{})]})}var ge=function(){return Object(oe.jsxs)("div",{className:"\n      w-96 p-4 space-y-2\n      flex flex-col justify-center items-center\n    ",children:[Object(oe.jsx)("div",{className:"\n        text-xl p-2\n      ",children:"MedRhythms DJ Mix"}),Object(oe.jsx)(se,{}),Object(oe.jsx)(me,{}),Object(oe.jsx)(je,{}),Object(oe.jsx)(ye,{})]})},xe=Object(f.a)({reducer:{analyzer:be,fileHandler:A,parameters:K,renderer:U}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(oe.jsx)(r.a.StrictMode,{children:Object(oe.jsx)(d.a,{store:xe,children:Object(oe.jsx)(ge,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[23,1,2]]]);
//# sourceMappingURL=main.7e9d6fc1.chunk.js.map